// ---------------------------------------------------------
        // REPLACE THE setupCart FUNCTION WITH THIS VERSION
        // ---------------------------------------------------------
        function setupCart() {
            const cartIcon = document.getElementById('cartIcon');
            const cartModal = document.getElementById('cartModal');
            const closeCart = document.getElementById('closeCart');
            const clearCart = document.getElementById('clearCart');
            const checkoutBtn = document.getElementById('checkoutBtn');
            const cartItemsContainer = document.getElementById('cartItems'); // Select the container

            // Open cart modal
            cartIcon.addEventListener('click', () => {
                cartModal.style.display = 'block';
                updateCartDisplay();
            });

            // Close cart modal
            closeCart.addEventListener('click', () => {
                cartModal.style.display = 'none';
            });

            // Clear cart
            clearCart.addEventListener('click', () => {
                if (cart.length === 0) {
                    alert('Cart is already empty!');
                    return;
                }
                
                if (confirm('Are you sure you want to clear your cart?')) {
                    cart = [];
                    saveCart();
                    updateCartBadge();
                    updateCartDisplay();
                    alert('Cart cleared successfully!');
                }
            });

            // Checkout
            checkoutBtn.addEventListener('click', () => {
                if (cart.length === 0) {
                    alert('Your cart is empty!');
                    return;
                }
                sendOrderToWhatsApp();
            });

            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === cartModal) {
                    cartModal.style.display = 'none';
                }
            });

            // FIX: Attach the event listener ONCE to the container (Event Delegation)
            // This ensures buttons work immediately without needing to be re-attached
            cartItemsContainer.addEventListener('click', handleCartItemClick);

            // Add to cart buttons with customization
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-to-cart-btn') || e.target.closest('.add-to-cart-btn')) {
                    const button = e.target.classList.contains('add-to-cart-btn') ? e.target : e.target.closest('.add-to-cart-btn');
                    const name = button.getAttribute('data-name');
                    const price = button.getAttribute('data-price');
                    const hasVariants = button.getAttribute('data-has-variants') === 'true';
                    const hasExtras = button.getAttribute('data-has-extras') === 'true';
                    
                    if (hasVariants || hasExtras) {
                        openCustomizationModal(name, hasVariants, hasExtras);
                    } else {
                        addToCart(name, parseInt(price), null, []);
                        showAddFeedback(button);
                    }
                }
            });
        }

        // ---------------------------------------------------------
        // REPLACE THE updateCartDisplay FUNCTION WITH THIS VERSION
        // ---------------------------------------------------------
        function updateCartDisplay() {
            console.log('Updating cart display, current cart:', cart);
            
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            const emptyCartMessage = document.getElementById('emptyCartMessage');
            
            if (cart.length === 0) {
                emptyCartMessage.style.display = 'block';
                cartItems.innerHTML = '';
                // Append the empty message back since innerHTML cleared it
                cartItems.appendChild(emptyCartMessage);
                cartTotal.textContent = 'Total: Rs 0';
                return;
            }
            
            emptyCartMessage.style.display = 'none';
            
            let itemsHTML = '';
            let total = 0;
            
            // Re-add the empty message hidden so it doesn't get lost
            itemsHTML += `<div class="empty-cart-message" id="emptyCartMessage" style="display:none"><i class="fas fa-shopping-cart"></i><p>Your cart is empty</p></div>`;

            cart.forEach((item, index) => {
                const itemTotal = item.totalPrice;
                total += itemTotal;
                
                let description = '';
                if (item.variant) {
                    description += `<div class="cart-item-variant">Variant: ${item.variant.name}</div>`;
                }
                if (item.extras && item.extras.length > 0) {
                    description += `<div class="cart-item-extras">Extras: ${item.extras.map(extra => extra.name).join(', ')}</div>`;
                }
                
                itemsHTML += `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name} Ã— ${item.quantity}</div>
                            ${description}
                            <div class="cart-item-price">Rs ${itemTotal}</div>
                        </div>
                        <div class="cart-item-controls">
                            <button class="quantity-btn" data-index="${index}" data-action="decrease">-</button>
                            <span class="quantity-display">${item.quantity}</span>
                            <button class="quantity-btn" data-index="${index}" data-action="increase">+</button>
                            <button class="remove-btn" data-index="${index}"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `;
            });
            
            cartItems.innerHTML = itemsHTML;
            cartTotal.textContent = `Total: Rs ${total}`;
            
            console.log('Cart display updated with', cart.length, 'items');
            
            // NOTE: We removed setupCartItemControls() from here because
            // the listener in setupCart() now handles everything permanently.
        }

        // ---------------------------------------------------------
        // DELETE THE setupCartItemControls FUNCTION
        // It is no longer needed.
        // ---------------------------------------------------------
